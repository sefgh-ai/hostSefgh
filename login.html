<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="icon" type="image/png" href="https://v1.sefgh.org/assets/favicon.png"> <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js"
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111111;
        }
        .gradient-text {
            background: linear-gradient(90deg, #A855F7, #D946EF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        /* Base padding for form and promo containers, adjusted for smaller screens */
        .form-container, .promo-container {
            padding: 1.5rem; /* Slightly reduced base padding for mobile */
        }
        @media (min-width: 640px) { /* Small screens (sm) */
            .form-container, .promo-container {
                padding: 2rem;
            }
        }
        @media (min-width: 1024px) { /* Large screens (lg) */
            .form-container {
                padding: 4rem 6rem;
            }
            .promo-container {
                padding: 4rem 6rem;
            }
        }
        /* Ensure the canvas fills its container */
        #scene-container canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        /* Animation styles for individual words */
        .animated-word {
            display: inline-block; /* Allows individual word animation */
            opacity: 0;
            transform: translateY(20px); /* Start slightly below */
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Smooth transition */
        }
        .animated-word.fade-in-up {
            opacity: 1;
            transform: translateY(0);
        }
        /* New style for promotional background image */
        .promo-background-image {
            background-image: url('https://v1.sefgh.org/assets/loginEarth.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: brightness(0.6); /* Slightly dim the image for text readability */
        }
        /* Stylish dropdown specific styles */
        .custom-select-wrapper {
            position: relative;
            display: inline-block;
            width: auto; /* Adjust width as needed */
        }
        /* Styles for the custom dropdown button */
        .custom-select-button {
            background-color: #1E1E1E; /* Dark background */
            border: 1px solid #374151; /* Gray-700 border */
            color: #D1D5DB; /* Gray-300 text */
            font-size: 0.875rem; /* text-sm */
            border-radius: 0.5rem; /* Subtle rounded corners for the button */
            padding-left: 0.75rem; /* pl-3 */
            padding-right: 2.5rem; /* pr-10 to make space for arrow */
            padding-top: 0.5rem; /* py-2 */
            padding-bottom: 0.5rem; /* py-2 */
            cursor: pointer;
            width: 100%; /* Fill parent width */
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color 0.2s, box-shadow 0.2s; /* Smooth transitions for focus */
        }
        .custom-select-button:focus {
            outline: none;
            border-color: #8B5CF6; /* Purple-500 focus ring */
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.5); /* Custom focus ring */
        }
        .custom-select-button:hover {
            border-color: #6B21A8; /* Darker purple on hover */
        }

        /* Styles for the dropdown options list */
        .custom-select-options {
            position: absolute;
            top: 100%; /* Position below the button */
            left: 0;
            right: 0;
            background-color: #1E1E1E; /* Dark background for options */
            border: 1px solid #374151; /* Gray-700 border */
            border-radius: 0.5rem;
            margin-top: 0.25rem; /* Small space below button */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 50; /* Ensure it's above other content */
            list-style: none; /* Remove default list styling */
            padding: 0.25rem 0; /* Vertical padding for options */
            max-height: 200px; /* Limit height and enable scrolling */
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;

            /* Hide scrollbar for Chrome, Safari and Opera */
            &::-webkit-scrollbar {
                display: none;
            }
            /* Hide scrollbar for IE, Edge and Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .custom-select-options.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Styles for individual dropdown options */
        .custom-select-option {
            padding: 0.75rem 1rem; /* py-3 px-4 */
            color: #D1D5DB; /* Gray-300 text */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .custom-select-option:hover {
            background-color: #2D2D2D; /* Darker hover background */
        }
        .custom-select-option.selected {
            background-color: #6B21A8; /* Purple-800 for selected item */
            color: white;
            font-weight: 600; /* Semi-bold for selected */
        }

        /* Message box styles */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allow clicks to pass through when hidden */
        }
        .message-box.show {
            opacity: 1;
            pointer-events: auto;
        }
        .message-box.error {
            background-color: #dc2626; /* Red-600 */
        }
        .message-box.success {
            background-color: #16a34a; /* Green-600 */
        }
        /* Style for Drive Files Output */
        #drive-files-output {
            margin-top: 1rem; /* mt-4 */
            background-color: #1E1E1E;
            border: 1px solid #374151;
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            max-height: 200px;
            overflow-y: auto;
            color: #D1D5DB;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <main class="w-full max-w-7xl bg-[#161616] rounded-2xl grid grid-cols-1 md:grid-cols-2 shadow-2xl shadow-black/30 border border-gray-800 overflow-hidden">
        
        <div class="form-container flex flex-col justify-center text-gray-300 order-last md:order-first">
            <div class="w-full max-w-md mx-auto">
                <div class="flex justify-between items-center mb-8">
                    <a href="https://sefgh.org" class="flex items-center gap-2 no-underline">
                        <div class="flex items-center gap-2">
                            <img src="https://v1.sefgh.org/assets/favicon.png" alt="SEFGH-AI Logo" class="w-8 h-8 rounded-full">
                            <span class="text-2xl font-bold text-white">SEFGH-AI</span>
                        </div>
                    </a>
                    <div class="custom-select-wrapper">
                        <button class="custom-select-button" id="language-select-button">
                            <span id="selected-language-text">English (EN)</span>
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <ul class="custom-select-options" id="language-options">
                            <li class="custom-select-option" data-lang="en">English (EN)</li>
                            <li class="custom-select-option" data-lang="es">Spanish (ES)</li>
                            <li class="custom-select-option" data-lang="fr">French (FR)</li>
                            <li class="custom-select-option" data-lang="de">German (DE)</li>
                            <li class="custom-select-option" data-lang="ja">Japanese (JA)</li>
                            <li class="custom-select-option" data-lang="zh">Chinese (ZH)</li>
                            <li class="custom-select-option" data-lang="hi">Hindi (HI)</li>
                            <li class="custom-select-option" data-lang="te">Telugu (TE)</li>
                        </ul>
                    </div>
                </div>

                <h1 class="text-3xl font-bold text-white mb-1" id="welcome-text" data-i18n="welcomeText">Welcome!</h1>
                <p class="text-gray-400 mb-6" id="welcome-subtext" data-i18n="welcomeSubtext">Log in to SEFGH-AI to continue to SEFGH-AI.</p>

                <div class="space-y-3 mb-6">
                    <button id="google-login-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 bg-[#1E1E1E] border border-gray-700 rounded-lg hover:bg-gray-800 transition-colors">
                        <img src="https://fonts.gstatic.com/s/i/productlogos/googleg/v6/24px.svg" alt="Google Logo" class="w-5 h-5">
                        <span class="text-white font-medium" data-i18n="loginWithGoogle">Log in with Google</span>
                    </button>
                    <button id="github-login-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 bg-[#1E1E1E] border border-gray-700 rounded-lg hover:bg-gray-800 transition-colors">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub Logo" class="w-5 h-5 p-0.5 bg-white rounded-full">
                        <span class="text-white font-medium" data-i18n="loginWithGitHub">Log in with GitHub</span>
                    </button>
                </div>

                <div class="flex items-center my-6">
                    <hr class="w-full border-gray-700">
                    <span class="px-4 text-gray-500 text-sm" data-i18n="orSeparator">OR</span>
                    <hr class="w-full border-gray-700">
                </div>

                <form id="loginForm" class="space-y-5">
                    <div>
                        <label for="email" class="text-sm font-medium text-gray-400" data-i18n="emailLabel">Email</label>
                        <input type="email" id="email" class="mt-1 w-full bg-[#1E1E1E] border border-gray-700 text-white rounded-lg p-3 focus:ring-purple-500 focus:border-purple-500 transition" placeholder="Your email address">
                    </div>
                    <div>
                        <div class="flex justify-between items-center">
                            <label for="password" class="text-sm font-medium text-gray-400" data-i18n="passwordLabel">Password</label>
                            <a href="#" class="text-sm text-purple-400 hover:underline" data-i18n="forgotPassword">Forgot password?</a>
                        </div>
                        <div class="relative mt-1">
                            <input type="password" id="password" class="w-full bg-[#1E1E1E] border border-gray-700 text-white rounded-lg p-3 pr-10 focus:ring-purple-500 focus:border-purple-500 transition" placeholder="Your password">
                            <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-300">
                                <svg id="eye-open" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                <svg id="eye-closed" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .946-3.012 3.42-5.32 6.57-6.175M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.582 17.582A7.01 7.01 0 0112 18c-3.182 0-5.94-1.94-7.394-4.582A9.98 9.98 0 014.416 9.416M12 12l2.38 2.38m-4.76-4.76L12 12"></path></svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-[#2a2a2a] text-white font-semibold py-3 rounded-lg hover:bg-[#3a3a3a] transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500" data-i18n="loginButton">
                        Log in
                    </button>
                </form>

                <p class="text-center text-sm text-gray-400 mt-8" data-i18n="noAccountText">
                    Don't have an account? 
                    <a href="signup.html" class="font-medium text-purple-400 hover:underline" data-i18n="signUpLink">Sign up</a>
                </p>

                <div id="user-info" class="text-center text-sm text-gray-400 mt-4 hidden">
                    Logged in as: <span id="user-id" class="font-medium text-purple-400"></span>
                    <div class="mt-4 flex flex-col sm:flex-row justify-center items-center gap-3">
                        <button id="logout-btn" class="w-full sm:w-auto text-red-400 hover:underline" data-i18n="logoutButton">Log out</button>
                    </div>
                </div>
                 </div>
        </div>

        <div class="promo-container relative flex flex-col items-center justify-center text-center text-white bg-[#1a1a1a] min-h-[400px] md:min-h-full order-first md:order-last md:pt-24 md:pb-8 promo-background-image">
            <div class="relative z-10">
                   <h2 class="text-3xl md:text-4xl font-bold leading-tight">
                    <span id="promo-animated-text"></span>
                </h2>
            </div>
            <div id="scene-container" class="absolute inset-0 z-0"></div>
        </div>

    </main>

    <div id="message-box" class="message-box"></div>

    <script type="module">
        import * as THREE from 'three';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signInWithEmailAndPassword,
            signOut,
            GoogleAuthProvider,
            GithubAuthProvider,
            signInWithPopup
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDqQbPoF5XFB_Ii-n1UWiMt0rAcbTBZIzk",
            authDomain: "sefgh-authentication.firebaseapp.com",
            projectId: "sefgh-authentication",
            storageBucket: "sefgh-authentication.appspot.com",
            messagingSenderId: "66121663860",
            appId: "1:66121663860:web:343d5c56531cebc3a81821",
            measurementId: "G-V7RTYHH228"
        };


        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app); // Initialize Firestore

        let userId = null; // Variable to store the current user ID

        // --- Internationalization (i18n) Logic ---
        const translations = {
            en: {
                welcomeText: "Welcome!",
                welcomeSubtext: "Log in to SEFGH-AI to continue to SEFGH-AI.",
                loginWithGoogle: "Log in with Google",
                loginWithGitHub: "Log in with GitHub",
                orSeparator: "OR",
                emailLabel: "Email",
                passwordLabel: "Password",
                forgotPassword: "Forgot password?",
                loginButton: "Log in",
                noAccountText: "Don't have an account?",
                signUpLink: "Sign up",
                logoutButton: "Log out",
                connectDrive: "Connect Google Drive",
                driveConnected: "Google Drive connected successfully!",
                driveConnectFailed: "Failed to connect Google Drive: ",
                welcomeBack: "Welcome back, ",
                loggedInAs: "You are logged in as ",
                invalidCredentials: "Invalid email or password. Please try again.",
                unauthorizedDomain: "This domain is not authorized. Please add \"{origin}\" to your Firebase Authorized Domains in the Firebase Console (Authentication -> Settings).",
                loggedInSuccess: "Logged in successfully! Redirecting...",
                logoutSuccess: "Logged out successfully.",
                logoutFailed: "Logout failed: ",
                googleLoginFailed: "Google login failed: ",
                githubLoginFailed: "GitHub login failed: "
            },
            es: {
                welcomeText: "¡Bienvenido!",
                welcomeSubtext: "Inicie sesión en SEFGH-AI para continuar con SEFGH-AI.",
                loginWithGoogle: "Iniciar sesión con Google",
                loginWithGitHub: "Iniciar sesión con GitHub",
                orSeparator: "O",
                emailLabel: "Correo electrónico",
                passwordLabel: "Contraseña",
                forgotPassword: "¿Olvidaste tu contraseña?",
                loginButton: "Iniciar sesión",
                noAccountText: "¿No tienes una cuenta?",
                signUpLink: "Registrarse",
                logoutButton: "Cerrar sesión",
                connectDrive: "Conectar Google Drive",
                driveConnected: "¡Google Drive conectado con éxito!",
                driveConnectFailed: "Error al conectar Google Drive: ",
                welcomeBack: "¡Bienvenido de nuevo, ",
                loggedInAs: "Has iniciado sesión como ",
                invalidCredentials: "Correo electrónico o contraseña no válidos. Por favor, inténtelo de nuevo.",
                unauthorizedDomain: "Este dominio no está autorizado. Agregue \"{origin}\" a sus Dominios Autorizados de Firebase en la Consola de Firebase (Autenticación -> Configuración).",
                loggedInSuccess: "¡Sesión iniciada con éxito! Redirigiendo...",
                logoutSuccess: "Sesión cerrada con éxito.",
                logoutFailed: "Error al cerrar sesión: ",
                googleLoginFailed: "Error al iniciar sesión con Google: ",
                githubLoginFailed: "Error al iniciar sesión con GitHub: "
            },
            // ... other languages remain the same
            fr: {
                welcomeText: "Bienvenue !",
                welcomeSubtext: "Connectez-vous à SEFGH-AI pour continuer vers SEFGH-AI.",
                loginWithGoogle: "Se connecter avec Google",
                loginWithGitHub: "Se connecter avec GitHub",
                orSeparator: "OU",
                emailLabel: "E-mail",
                passwordLabel: "Mot de passe",
                forgotPassword: "Mot de passe oublié ?",
                loginButton: "Se connecter",
                noAccountText: "Vous n'avez pas de compte ?",
                signUpLink: "S'inscrire",
                logoutButton: "Se déconnecter",
                connectDrive: "Connecter Google Drive",
                driveConnected: "Google Drive connecté avec succès !",
                driveConnectFailed: "Échec de la connexion à Google Drive : ",
                welcomeBack: "Bienvenue de nouveau, ",
                loggedInAs: "Vous êtes connecté en tant que ",
                invalidCredentials: "Email ou mot de passe invalide. Veuillez réessayer.",
                unauthorizedDomain: "Ce domaine n'est pas autorisé. Veuillez ajouter \"{origin}\" à vos Domaines autorisés Firebase dans la console Firebase (Authentification -> Paramètres).",
                loggedInSuccess: "Connexion réussie ! Redirection...",
                logoutSuccess: "Déconnexion réussie.",
                logoutFailed: "Échec de la déconnexion : ",
                googleLoginFailed: "Échec de la connexion Google : ",
                githubLoginFailed: "Échec de la connexion GitHub : "
            },
            de: {
                welcomeText: "Willkommen!",
                welcomeSubtext: "Melden Sie sich bei SEFGH-AI an, um mit SEFGH-AI fortzufahren.",
                loginWithGoogle: "Mit Google anmelden",
                loginWithGitHub: "Mit GitHub anmelden",
                orSeparator: "ODER",
                emailLabel: "E-Mail",
                passwordLabel: "Passwort",
                forgotPassword: "Passwort vergessen?",
                loginButton: "Anmelden",
                noAccountText: "Sie haben noch kein Konto?",
                signUpLink: "Registrieren",
                logoutButton: "Abmelden",
                connectDrive: "Google Drive verbinden",
                driveConnected: "Google Drive erfolgreich verbunden!",
                driveConnectFailed: "Fehler beim Verbinden mit Google Drive: ",
                welcomeBack: "Willkommen zurück, ",
                loggedInAs: "Sie sind angemeldet als ",
                invalidCredentials: "Ungültige E-Mail oder Passwort. Bitte versuchen Sie es erneut.",
                unauthorizedDomain: "Diese Domain ist nicht autorisiert. Bitte fügen Sie „{origin}“ zu Ihren autorisierten Firebase-Domains in der Firebase-Konsole (Authentifizierung -> Einstellungen) hinzu.",
                loggedInSuccess: "Erfolgreich angemeldet! Weiterleiten...",
                logoutSuccess: "Erfolgreich abgemeldet.",
                logoutFailed: "Abmeldung fehlgeschlagen: ",
                googleLoginFailed: "Google-Anmeldung fehlgeschlagen: ",
                githubLoginFailed: "GitHub-Anmeldung fehlgeschlagen: "
            },
             ja: {
                welcomeText: "ようこそ！",
                welcomeSubtext: "SEFGH-AIにログインしてSEFGH-AIを続行してください。",
                loginWithGoogle: "Googleでログイン",
                loginWithGitHub: "GitHubでログイン",
                orSeparator: "または",
                emailLabel: "メールアドレス",
                passwordLabel: "パスワード",
                forgotPassword: "パスワードをお忘れですか？",
                loginButton: "ログイン",
                noAccountText: "アカウントをお持ちではありませんか？",
                signUpLink: "サインアップ",
                logoutButton: "ログアウト",
                connectDrive: "Googleドライブを接続",
                driveConnected: "Google ドライブが正常に接続されました！",
                driveConnectFailed: "Googleドライブの接続に失敗しました：",
                welcomeBack: "おかえりなさい、",
                loggedInAs: "としてログインしています",
                invalidCredentials: "無効なメールアドレスまたはパスワードです。もう一度お試しください。",
                unauthorizedDomain: "このドメインは承認されていません。Firebaseコンソール（認証 -> 設定）で「{origin}」をFirebase承認済みドメインに追加してください。",
                loggedInSuccess: "ログインに成功しました！リダイレクトしています...",
                logoutSuccess: "ログアウトに成功しました。",
                logoutFailed: "ログアウトに失敗しました：",
                googleLoginFailed: "Googleログインに失敗しました：",
                githubLoginFailed: "GitHubログインに失敗しました： "
            },
            zh: {
                welcomeText: "欢迎！",
                welcomeSubtext: "登录 SEFGH-AI 以继续。",
                loginWithGoogle: "使用 Google 登录",
                loginWithGitHub: "使用 GitHub 登录",
                orSeparator: "或",
                emailLabel: "电子邮件",
                passwordLabel: "密码",
                forgotPassword: "忘记密码？",
                loginButton: "登录",
                noAccountText: "没有帐户？",
                signUpLink: "注册",
                logoutButton: "登出",
                connectDrive: "连接谷歌云端硬盘",
                driveConnected: "谷歌云端硬盘连接成功！",
                driveConnectFailed: "连接谷歌云端硬盘失败：",
                welcomeBack: "欢迎回来，",
                loggedInAs: "您已登录为 ",
                invalidCredentials: "无效的电子邮件或密码。请重试。",
                unauthorizedDomain: "此域未授权。请将“{origin}”添加到 Firebase 控制台（身份验证 -> 设置）中的 Firebase 授权域。",
                loggedInSuccess: "登录成功！正在重定向...",
                logoutSuccess: "登出成功。",
                logoutFailed: "登出失败：",
                googleLoginFailed: "Google 登录失败：",
                githubLoginFailed: "GitHub 登录失败： "
            },
            hi: {
                welcomeText: "स्वागत है!",
                welcomeSubtext: "SEFGH-AI पर जारी रखने के लिए SEFGH-AI में लॉग इन करें।",
                loginWithGoogle: "Google से लॉग इन करें",
                loginWithGitHub: "GitHub से लॉग इन करें",
                orSeparator: "या",
                emailLabel: "ईमेल",
                passwordLabel: "पासवर्ड",
                forgotPassword: "पासवर्ड भूल गए?",
                loginButton: "लॉग इन करें",
                noAccountText: "खाता नहीं है?",
                signUpLink: "साइन अप करें",
                logoutButton: "लॉग आउट",
                connectDrive: "गूगल ड्राइव कनेक्ट करें",
                driveConnected: "गूगल ड्राइव सफलतापूर्वक कनेक्ट हो गया!",
                driveConnectFailed: "गूगल ड्राइव कनेक्ट करने में विफल: ",
                welcomeBack: "वापस स्वागत है, ",
                loggedInAs: "आप के रूप में लॉग इन हैं ",
                invalidCredentials: "अमान्य ईमेल या पासवर्ड। कृपया पुनः प्रयास करें।",
                unauthorizedDomain: "यह डोमेन अधिकृत नहीं है। कृपया Firebase कंसोल (प्रमाणीकरण -> सेटिंग्स) में अपने Firebase अधिकृत डोमेन में \"{origin}\" जोड़ें।",
                loggedInSuccess: "सफलतापूर्वक लॉग इन किया गया! रीडायरेक्ट किया जा रहा है...",
                logoutSuccess: "सफलतापूर्वक लॉग आउट किया गया।",
                logoutFailed: "लॉग आउट विफल: ",
                googleLoginFailed: "Google लॉग इन विफल: ",
                githubLoginFailed: "GitHub लॉग इन विफल: "
            },
            te: {
                welcomeText: "స్వాగతం!",
                welcomeSubtext: "SEFGH-AIకి కొనసాగడానికి SEFGH-AIకి లాగిన్ అవ్వండి.",
                loginWithGoogle: "Googleతో లాగిన్ అవ్వండి",
                loginWithGitHub: "GitHubతో లాగిన్ అవ్వండి",
                orSeparator: "లేదా",
                emailLabel: "ఇమెయిల్",
                passwordLabel: "పాస్వర్డ్",
                forgotPassword: "పాస్వర్డ్ మర్చిపోయారా?",
                loginButton: "లాగిన్ అవ్వండి",
                noAccountText: "ఖాతా లేదా?",
                signUpLink: "సైన్ అప్ చేయండి",
                logoutButton: "లాగ్ అవుట్",
                connectDrive: "Google డిస్క్ కనెక్ట్ చేయండి",
                driveConnected: "Google డిస్క్ విజయవంతంగా కనెక్ట్ చేయబడింది!",
                driveConnectFailed: "Google డిస్క్ కనెక్ట్ చేయడంలో విఫలమైంది: ",
                welcomeBack: "తిరిగి స్వాగతం, ",
                loggedInAs: "మీరు లాగిన్ అయ్యారు ",
                invalidCredentials: "చెల్లని ఇమెయిల్ లేదా పాస్‌వర్డ్. దయచేసి మళ్లీ ప్రయత్నించండి.",
                unauthorizedDomain: "ఈ డొమైన్ అధీకృతం కాదు. దయచేసి మీ Firebase అధీకృత డొమైన్‌లలో \"{origin}\"ని Firebase కన్సోల్ (ప్రామాణీకరణ -> సెట్టింగ్‌లు)లో జోడించండి.",
                loggedInSuccess: "విజయవంతంగా లాగిన్ అయ్యారు! దారి మళ్లింపు...",
                logoutSuccess: "విజయవంతంగా లాగ్ అవుట్ అయ్యారు.",
                logoutFailed: "లాగ్ అవుట్ విఫలమైంది: ",
                googleLoginFailed: "Google లాగిన్ విఫలమైంది: ",
                githubLoginFailed: "GitHub లాగిన్ విఫలమైంది: "
            }
        };

        const languageMap = {
            'en': 'English (EN)',
            'es': 'Spanish (ES)',
            'fr': 'French (FR)',
            'de': 'German (DE)',
            'ja': 'Japanese (JA)',
            'zh': 'Chinese (ZH)',
            'hi': 'Hindi (HI)',
            'te': 'Telugu (TE)'
        };

        function setLanguage(langCode) {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[langCode] && translations[langCode][key]) {
                    let text = translations[langCode][key];
                    if (key === 'unauthorizedDomain') {
                        text = text.replace('{origin}', window.location.origin);
                    }
                    element.textContent = text;
                }
            });
            const selectedLangTextElement = document.getElementById('selected-language-text');
            if (selectedLangTextElement) {
                selectedLangTextElement.textContent = languageMap[langCode];
            }
            document.querySelectorAll('.custom-select-option').forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-lang') === langCode) {
                    option.classList.add('selected');
                }
            });
            localStorage.setItem('selectedLanguage', langCode);
        }

        function showMessage(message, type = 'info') {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = message;
            msgBox.className = 'message-box show';
            if (type === 'error') {
                msgBox.classList.add('error');
            } else if (type === 'success') {
                msgBox.classList.add('success');
            } else {
                msgBox.classList.add('info');
            }
            setTimeout(() => {
                msgBox.classList.remove('show');
            }, 3000);
        }
        
        // --- Handle Successful Login ---
        function handleLoginSuccess(user, additionalInfo = {}) {
            const userInfo = {
                uid: user.uid,
                email: user.email,
                displayName: user.displayName,
                ...additionalInfo
            };
            localStorage.setItem('user', JSON.stringify(userInfo));
            showMessage(translations[localStorage.getItem('selectedLanguage') || 'en'].loggedInSuccess, 'success');
            setTimeout(() => {
                window.location.href = 'searchpage.html';
            }, 1500); // Redirect after 1.5 seconds
        }


        // --- Firebase Auth State Listener ---
        onAuthStateChanged(auth, async (user) => {
            const loginForm = document.getElementById('loginForm');
            const socialLogins = document.querySelector('.space-y-3.mb-6');
            const separator = document.querySelector('.flex.items-center.my-6');
            const signUpLink = document.querySelector('p.text-center.text-sm.text-gray-400.mt-8');
            const userInfoDiv = document.getElementById('user-info');
            const userIdSpan = document.getElementById('user-id');
            const welcomeText = document.getElementById('welcome-text');
            const welcomeSubtext = document.getElementById('welcome-subtext');
            const logoutBtn = document.getElementById('logout-btn');

            if (user) {
                // User is signed in
                userId = user.uid;

                // Hide login elements and show user info
                if (loginForm) loginForm.classList.add('hidden');
                if (socialLogins) socialLogins.classList.add('hidden');
                if (separator) separator.classList.add('hidden');
                if (signUpLink) signUpLink.classList.add('hidden');
                if (userInfoDiv) userInfoDiv.classList.remove('hidden');
                if (userIdSpan) userIdSpan.textContent = user.email || user.displayName || userId;
                if (welcomeText) welcomeText.textContent = `${translations[localStorage.getItem('selectedLanguage') || 'en'].welcomeBack}${user.email || user.displayName || 'User'}!`;
                if (welcomeSubtext) welcomeSubtext.textContent = `${translations[localStorage.getItem('selectedLanguage') || 'en'].loggedInAs}${user.email || user.displayName || 'an anonymous user'}.`;

                if (logoutBtn) {
                    logoutBtn.onclick = async () => {
                        try {
                            await signOut(auth);
                            localStorage.removeItem('user'); // Clear user from local storage
                            localStorage.removeItem('githubApiToken');
                            localStorage.removeItem('googleDriveToken');
                            showMessage(translations[localStorage.getItem('selectedLanguage') || 'en'].logoutSuccess, 'success');
                             // Explicitly redirect to the same page to reset state
                            window.location.href = window.location.href.split('#')[0];
                        } catch (error) {
                            console.error("Logout error:", error);
                            showMessage(`${translations[localStorage.getItem('selectedLanguage') || 'en'].logoutFailed}${error.message}`, 'error');
                        }
                    };
                }
                
            } else {
                // User is signed out
                userId = null;
                
                // Show login elements and hide user info
                if (loginForm) loginForm.classList.remove('hidden');
                if (socialLogins) socialLogins.classList.remove('hidden');
                if (separator) separator.classList.remove('hidden');
                if (signUpLink) signUpLink.classList.remove('hidden');
                if (userInfoDiv) userInfoDiv.classList.add('hidden');
                if (userIdSpan) userIdSpan.textContent = '';
                
                // Reset welcome text
                if (welcomeText) welcomeText.textContent = translations[localStorage.getItem('selectedLanguage') || 'en'].welcomeText;
                if (welcomeSubtext) welcomeSubtext.textContent = translations[localStorage.getItem('selectedLanguage') || 'en'].welcomeSubtext;
            }
        });

        // --- Email/Password Login ---
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    handleLoginSuccess(userCredential.user);
                } catch (error) {
                    console.error("Login error:", error);
                    let errorMessage = error.message;
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                        errorMessage = translations[localStorage.getItem('selectedLanguage') || 'en'].invalidCredentials;
                    } else if (error.code === 'auth/unauthorized-domain') {
                        errorMessage = translations[localStorage.getItem('selectedLanguage') || 'en'].unauthorizedDomain.replace('{origin}', window.location.origin);
                    }
                    showMessage(`Login failed: ${errorMessage}`, 'error');
                }
            });
        }

        // --- Social Logins ---
        const googleLoginBtn = document.getElementById('google-login-btn');
        const githubLoginBtn = document.getElementById('github-login-btn');

        if (googleLoginBtn) {
            googleLoginBtn.addEventListener('click', () => { 
                const provider = new GoogleAuthProvider();
                provider.addScope('https://www.googleapis.com/auth/drive.file');

                signInWithPopup(auth, provider)
                    .then((result) => {
                        const credential = GoogleAuthProvider.credentialFromResult(result);
                        const token = credential.accessToken;
                        handleLoginSuccess(result.user, { googleDriveToken: token });
                    }).catch((error) => {
                        console.error("Google login error:", error);
                        let errorMessage = error.message;
                        if (error.code === 'auth/unauthorized-domain') {
                            errorMessage = translations[localStorage.getItem('selectedLanguage') || 'en'].unauthorizedDomain.replace('{origin}', window.location.origin);
                        }
                        showMessage(`${translations[localStorage.getItem('selectedLanguage') || 'en'].googleLoginFailed}${errorMessage}`, 'error');
                    });
            });
        }

        if (githubLoginBtn) {
            githubLoginBtn.addEventListener('click', () => {
                const provider = new GithubAuthProvider();
                provider.addScope('repo');

                signInWithPopup(auth, provider)
                    .then((result) => {
                        const credential = GithubAuthProvider.credentialFromResult(result);
                        const token = credential.accessToken;
                        handleLoginSuccess(result.user, { githubApiToken: token });
                    }).catch((error) => {
                        console.error("GitHub login error:", error);
                        let errorMessage = error.message;
                        if (error.code === 'auth/unauthorized-domain') {
                            errorMessage = translations[localStorage.getItem('selectedLanguage') || 'en'].unauthorizedDomain.replace('{origin}', window.location.origin);
                        }
                        showMessage(`${translations[localStorage.getItem('selectedLanguage') || 'en'].githubLoginFailed}${errorMessage}`, 'error');
                    });
            });
        }


        // --- Password Toggle ---
        const togglePassword = document.getElementById('togglePassword');
        const password = document.getElementById('password');
        const eyeOpen = document.getElementById('eye-open');
        const eyeClosed = document.getElementById('eye-closed');

        if (togglePassword && password && eyeOpen && eyeClosed) {
            togglePassword.addEventListener('click', function (e) {
                const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
                password.setAttribute('type', type);
                eyeOpen.classList.toggle('hidden');
                eyeClosed.classList.toggle('hidden');
            });
        }

        // --- Three.js Scene ---
        const container = document.getElementById('scene-container');
        
        if (container) {
            let scene, camera, renderer, cube, arrowGroup;

            function init() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.z = 5;
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                container.appendChild(renderer.domElement);
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(5, 5, 5);
                scene.add(directionalLight);
                const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
                const material = new THREE.MeshStandardMaterial({
                    color: 0x222222,
                    roughness: 0.5,
                    metalness: 0.1,
                    wireframe: true,
                    wireframeLinewidth: 2,
                });
                cube = new THREE.Mesh(geometry, material);
                scene.add(cube);
                arrowGroup = new THREE.Group();
                const ringGeometry = new THREE.TorusGeometry(2.5, 0.02, 16, 100);
                const ringMaterial = new THREE.MeshBasicMaterial({ color: 0x8B5CF6, transparent: true, opacity: 0.3 });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                const arrowHeadGeometry = new THREE.ConeGeometry(0.2, 0.4, 32);
                const arrowHeadMaterial = new THREE.MeshStandardMaterial({ color: 0xA855F7 });
                const arrowHead = new THREE.Mesh(arrowHeadGeometry, arrowHeadMaterial);
                arrowHead.position.y = 2.5;
                arrowHead.rotation.z = Math.PI;
                arrowGroup.add(ring);
                arrowGroup.add(arrowHead);
                scene.add(arrowGroup);
                window.addEventListener('resize', onWindowResize, false);
            }

            function onWindowResize() {
                if (!renderer || !camera || !container) return;
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }

            function animate() {
                requestAnimationFrame(animate);
                if (cube) {
                    cube.rotation.x += 0.002;
                    cube.rotation.y += 0.002;
                }
                if (arrowGroup) {
                    arrowGroup.rotation.z -= 0.01;
                }
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
            }
            document.addEventListener('DOMContentLoaded', function() {
                init();
                animate();
                startPromoTextAnimation();
            });
        }

        // --- Promotional Text Animation ---
        const promoTexts = [
            "Search smarter. Discover better code.",
            "Find hidden gems, not just hype.",
            "No keywords. Just real results.",
            "Describe it once. Get matched fast.",
            "Natural language in. Repos out.",
            "50 million projects. One smart search.",
            "Smarter search. Sharper results.",
            "Less noise. More signal. All GitHub.",
            "Built for devs. Tuned for discovery.",
            "One search engine. Endless code finds."
        ];
        let currentTextIndex = 0;
        const promoTextElement = document.getElementById('promo-animated-text');

        function animateWords(text) {
            promoTextElement.innerHTML = '';
            const words = text.split(/\s+/);
            let delay = 0;

            words.forEach((word, index) => {
                if (word === '') return;
                const wordSpan = document.createElement('span');
                wordSpan.textContent = word;
                wordSpan.classList.add('animated-word');
                const gradientSegments = [
                    "better code.", "just hype.", "real results.", "matched fast.", "Repos out.",
                    "smart search.", "Sharper results.", "All GitHub.", "for discovery.", "code finds."
                ];
                const fullPhrase = promoTexts[currentTextIndex];
                let applyGradient = false;
                for (const segment of gradientSegments) {
                    if (fullPhrase.endsWith(segment)) {
                        const segmentWords = segment.split(/\s+/);
                        if (segmentWords.includes(word) || (segmentWords.length === 1 && word === segmentWords[0])) {
                             applyGradient = true;
                             break;
                        }
                    }
                }
                if (applyGradient) {
                    wordSpan.classList.add('gradient-text');
                }
                promoTextElement.appendChild(wordSpan);
                if (index < words.length - 1) {
                    promoTextElement.appendChild(document.createTextNode('\u00A0'));
                }
                setTimeout(() => {
                    wordSpan.classList.add('fade-in-up');
                }, delay);
                delay += 100;
            });
        }

        function updatePromoText() {
            if (!promoTextElement) return;
            animateWords(promoTexts[currentTextIndex]);
            currentTextIndex = (currentTextIndex + 1) % promoTexts.length;
        }

        function startPromoTextAnimation() {
            if (promoTextElement) {
                updatePromoText();
                setInterval(updatePromoText, 4000); 
            }
        }

        // --- Custom Language Dropdown Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const languageSelectButton = document.getElementById('language-select-button');
            const languageOptions = document.getElementById('language-options');
            const customSelectOptions = document.querySelectorAll('.custom-select-option');

            if (languageSelectButton && languageOptions) {
                languageSelectButton.addEventListener('click', () => {
                    languageOptions.classList.toggle('show');
                });
            }

            customSelectOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const selectedLang = option.getAttribute('data-lang');
                    setLanguage(selectedLang);
                    languageOptions.classList.remove('show');
                });
            });

            document.addEventListener('click', (event) => {
                if (languageSelectButton && languageOptions && !languageSelectButton.contains(event.target) && !languageOptions.contains(event.target)) {
                    languageOptions.classList.remove('show');
                }
            });

            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            setLanguage(savedLanguage);
        });
    </script>
</body>
</html>
